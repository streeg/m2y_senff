module M2ySenff
  class SenffCapital < SenffModule
    def initialize(access_key, secret_key, url)
      startModule(access_key, secret_key, url)
    end

    def contractsList(params)
      headers = getAddressHeaders
      params[:nrInst] = getInstitution
      puts params
      url = @url + WORKING_CAPITAL_CONTRACTS_LIST
      puts url
      response = @request.post(url, params, headers)
      #TODO desfazer o mock depois de EP ajustado pela Sinqia.
      response = {
          "cdErroInterno": 0,
          "contratos": [
            {
              "nrInst": 1414,
              "nrAgen": 19,
              "cdClient": 144118,
              "nrContra": 3750000,
              "cdProdut": 21210,
              "tpContra": 1,
              "nrCres": 110204000,
              "nrPropos": 3750000,
              "qtPresta": 2,
              "pzMContr": 0,
              "pzMCaren": 0,
              "qtCarPre": 0,
              "qtMesCar": 0,
              "nrPrePag": 0,
              "nrPrxPre": 1,
              "nrUlprCl": 1,
              "idPeriod": 1,
              "idInfPre": "S",
              "idTipcre": 3,
              "idTipDeb": 8,
              "nrCCdebi": 0,
              "nrCCredi": 0,
              "nrMoed": 19,
              "nrBorder": 0,
              "nrContVi": 0,
              "idOriBor": 0,
              "nrPac": 0,
              "nrContCe": 0,
              "nrContrAnt": 0,
              "cdBanCob": 0,
              "cdAgeCob": 0,
              "idTipIof": "F",
              "idConces": "F",
              "idSeguro": "F",
              "idOutVlr": "F",
              "idAntecj": "P",
              "idPerTax": 31,
              "idRepact": " ",
              "idIofInf": "N",
              "idTpCalc": 1,
              "idSituac": 10,
              "idAntPos": "P",
              "idTipMoe": "N",
              "idTpOri": "M",
              "idStatus": 0,
              "idExtrat": "R",
              "idPerJur": 1,
              "idFAmort": 1,
              "idRefix": 1,
              "idTitCcd": 0,
              "idVcto": 3,
              "idRecurso": 0,
              "inMoet": 0E-10,
              "inAcmoet": 0E-10,
              "tpAnoval": 1,
              "tpCaren": 1,
              "tpIofCal": 0,
              "tpPeRefi": 0,
              "tpNatJur": 2,
              "tpLiber": "T",
              "dtEntrad": 20211209,
              "dtAltera": 0,
              "dtContra": 20211209,
              "dtEncerr": 0,
              "dtVct1ap": 20220110,
              "dtLibemp": 20211209,
              "dtVctult": 20220209,
              "dtVctprx": 20220110,
              "dtIniVal": 0,
              "dtUltVen": 0,
              "dtContVi": 0,
              "dtUltMov": 20211209,
              "dtBase": 20211209,
              "dtSituac": 0,
              "vlMBasea": 166878.42000000,
              "vlContra": 163010.81,
              "vlQmCont": 163010.81000000,
              "vlIofCob": 932.81,
              "vlConces": 3178.00,
              "vlSeguro": 0.00,
              "vlOutVlr": 0.00,
              "vlRetido": 0.00,
              "vlJurAnt": 0.00,
              "vlEntrad": 0.00,
              "vlSdoDev": 166878.42,
              "vlSdmDev": 166878.42000000,
              "vlTotal": 166878.42,
              "vlTotqtm": 166878.42000000,
              "vlSegcre": 0.00,
              "vlBaseab": 0.00,
              "vlJuroab": 0.00,
              "vlCorrab": 0.00,
              "vlResidv": 0.00,
              "vlSdmdea": 0E-8,
              "vlSdodea": 0.00,
              "vlValpre": 83439.21,
              "vlPrxpre": 83439.21,
              "vlPrmpre": 83439.21000000,
              "vlDelcre": 0.00,
              "vlSdoctb": 0.00,
              "vlPagliq": 0.00,
              "txAno": 20.41270,
              "txReal": 1.509822,
              "txInform": 1.560000,
              "txEfetiv": 3.184547,
              "txConces": 0.000000,
              "txDelcre": 0.000000,
              "txLiquid": 0.00000,
              "txCusto": 0.00000,
              "cdConven": 19,
              "cdVendor": 0,
              "vlVendor": 0.00,
              "dtCtrbnd": 20211209,
              "dtVct1ju": 20220110,
              "nrDdapr": 60,
              "txRefcdc": 1.560000,
              "pcEqual": 0.000000,
              "idCarctr": 5,
              "nrCtrpre": 375,
              "vlSdojur": 3867.61,
              "vlSdopri": 163010.81,
              "vlMsdoju": 3867.61000000,
              "vlMsdopr": 163010.81000000,
              "vlMrenap": 0E-8,
              "vlMrenan": 0E-8,
              "vlMrenes": 0E-8,
              "vlMantes": 0E-8,
              "vlMsdoct": 0E-8,
              "vlMentra": 0E-8,
              "vlMconce": 3178.00000000,
              "vlMiofco": 932.81000000,
              "vlMsegur": 0E-8,
              "vlMoutvl": 0E-8,
              "pcIof": 0.00410,
              "pcIofadi": 0.38000,
              "vlRenrp": 0.00,
              "vlMrenrp": 0E-8,
              "tpAprren": 0,
              "vlSdcess": 0.00,
              "vlMsdces": 0E-8,
              "vlSdctce": 0.00,
              "vlMsdctc": 0E-8,
              "txSprpas": 0.000000,
              "vlCessao": 0.00,
              "vlMcessa": 0E-8,
              "vlGiro": 0.00,
              "idDestpr": 2,
              "vlRapcap": 0.00,
              "idMesjur": 1,
              "idCcb": 2,
              "idEqual": "D",
              "vlEqual": 0.00,
              "dtCtcria": 20220413
          },
          {
            "nrInst": 1414,
            "nrAgen": 19,
            "cdClient": 144118,
            "nrContra": 3730000,
            "cdProdut": 22210,
            "tpContra": 1,
            "nrCres": 110204042,
            "nrPropos": 3730000,
            "qtPresta": 10,
            "pzMContr": 0,
            "pzMCaren": 0,
            "qtCarPre": 0,
            "qtMesCar": 0,
            "nrPrePag": 0,
            "nrPrxPre": 1,
            "nrUlprCl": 1,
            "idPeriod": 1,
            "idInfPre": "S",
            "idTipcre": 3,
            "idTipDeb": 9,
            "nrCCdebi": 0,
            "nrCCredi": 0,
            "nrBorder": 0,
            "nrContVi": 0,
            "idOriBor": 0,
            "nrPac": 0,
            "nrContCe": 0,
            "nrContrAnt": 0,
            "cdBanCob": 0,
            "cdAgeCob": 0,
            "idTipIof": "F",
            "idConces": "F",
            "idSeguro": "F",
            "idOutVlr": "F",
            "idAntecj": "P",
            "idPerTax": 30,
            "idRepact": " ",
            "idIofInf": "N",
            "idTpCalc": 2,
            "idSituac": 0,
            "idAntPos": "P",
            "idTipMoe": "N",
            "idTpOri": "M",
            "idStatus": 0,
            "idExtrat": "R",
            "idPerJur": 1,
            "idFAmort": 3,
            "idRefix": 1,
            "idTitCcd": 0,
            "idVcto": 3,
            "idRecurso": 0,
            "inMoet": 0E-10,
            "inAcmoet": 0E-10,
            "tpAnoval": 1,
            "tpCaren": 1,
            "tpIofCal": 0,
            "tpPeRefi": 0,
            "tpNatJur": 2,
            "tpLiber": "T",
            "dtEntrad": 20211209,
            "dtAltera": 0,
            "dtContra": 20211209,
            "dtEncerr": 0,
            "dtVct1ap": 20220110,
            "dtLibemp": 20211209,
            "dtMovlib": 20211209,
            "dtVctult": 20221010,
            "dtVctprx": 20220110,
            "dtIniVal": 0,
            "dtUltVen": 0,
            "dtContVi": 0,
            "dtUltMov": 20211209,
            "dtBase": 20211209,
            "dtSituac": 20211209,
            "vlMBasea": 608357.40000000,
            "vlContra": 470379.42,
            "vlQmCont": 470379.42000000,
            "vlIofCob": 5019.70,
            "vlConces": 9124.70,
            "vlSeguro": 0.00,
            "vlOutVlr": 0.00,
            "vlRetido": 0.00,
            "vlJurAnt": 0.00,
            "vlEntrad": 0.00,
            "vlSdoDev": 542645.38,
            "vlSdmDev": 542645.38000000,
            "vlTotal": 542645.38,
            "vlTotqtm": 542645.38000000,
            "vlSegcre": 0.00,
            "vlBaseab": 0.00,
            "vlJuroab": 0.00,
            "vlCorrab": 0.00,
            "vlResidv": 0.00,
            "vlSdmdea": 0E-8,
            "vlSdodea": 0.00,
            "vlValpre": 60835.74,
            "vlPrxpre": 60835.74,
            "vlPrmpre": 60835.74000000,
            "vlDelcre": 0.00,
            "vlSdoctb": 0.00,
            "vlPagliq": 0.00,
            "txAno": 33.00000,
            "txReal": 2.750000,
            "txInform": 2.750000,
            "txEfetiv": 3.362445,
            "txConces": 0.000000,
            "txDelcre": 0.000000,
            "txLiquid": 0.00000,
            "txCusto": 0.00000,
            "cdConven": 19,
            "cdVendor": 0,
            "vlVendor": 0.00,
            "dtCtrbnd": 20211209,
            "dtVct1ju": 20220110,
            "nrDdapr": 60,
            "txRefcdc": 2.750000,
            "pcEqual": 0.000000,
            "idCarctr": 5,
            "nrCtrpre": 373,
            "vlSdojur": 72265.96,
            "vlSdopri": 470379.42,
            "vlMsdoju": 72265.96000000,
            "vlMsdopr": 470379.42000000,
            "vlMrenap": 0E-8,
            "vlMrenan": 0E-8,
            "vlMrenes": 0E-8,
            "vlMantes": 0E-8,
            "vlMsdoct": 0E-8,
            "vlMentra": 0E-8,
            "vlMconce": 9124.70000000,
            "vlMiofco": 5019.70000000,
            "vlMsegur": 0E-8,
            "vlMoutvl": 0E-8,
            "pcIof": 0.00410,
            "pcIofadi": 0.38000,
            "vlRenrp": 0.00,
            "vlMrenrp": 0E-8,
            "tpAprren": 0,
            "vlSdcess": 0.00,
            "vlMsdces": 0E-8,
            "vlSdctce": 0.00,
            "vlMsdctc": 0E-8,
            "txSprpas": 0.000000,
            "vlCessao": 0.00,
            "vlMcessa": 0E-8,
            "vlGiro": 0.00,
            "idDestpr": 2,
            "vlRapcap": 0.00,
            "nrDialib": 50,
            "idMesjur": 1,
            "idCcb": 2,
            "idEqual": "D",
            "vlEqual": 0.00,
            "vlConcor": 9124.70,
            "vlSeguor": 0.00,
            "vlOutvor": 0.00,
            "dtCtcria": 20220413,
            "dtCredCl": 20211209
        }
          ]
        }
      begin
        contractsResponse = SenffModel.new(response)
      rescue StandardError
        nil
      end
      contractsResponse
    end
  
    def getContract(params)
      headers = getAddressHeaders
      params[:nrInst] = getInstitution
      #TODO retirar depois de ajustado o endpoint pela sinquia.
      params[:cdClient] = 144673   
      puts params
      url = @url +WORKING_CAPITAL_GET_CONTRACT
      puts url
      response = @request.post(url, params, headers)
      begin
        contractsResponse = SenffModel.new(response)
      rescue StandardError
        nil
      end
      contractsResponse
    end
  end
end
